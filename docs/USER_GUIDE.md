# Docker镜像转换服务 - 用户使用指南

## 📖 目录

- [快速开始](#快速开始)
- [系统登录](#系统登录)
- [基本使用流程](#基本使用流程)
- [功能详解](#功能详解)
- [高级功能](#高级功能)
- [常见问题](#常见问题)
- [最佳实践](#最佳实践)

## 🚀 快速开始

### 访问系统

服务部署完成后，通过浏览器访问系统：
```
http://your-server:8080
```

### 首次登录

1. 在登录页面输入默认Token：`docker-helper`
2. 点击"登录"按钮进入系统

![登录界面](docs/images/login.png)

## 🔐 系统登录

### Token认证

系统使用Token认证机制：
- **默认Token**: `docker-helper`
- **Token修改**: 登录后可在用户菜单中修改
- **安全建议**: 首次使用后立即修改默认Token

### 修改Token

1. 点击右上角用户头像
2. 选择"修改Token"
3. 输入新的Token
4. 确认修改

## 📋 基本使用流程

### 1. 镜像转换操作

#### 第一步：输入源镜像
在"镜像转换"卡片中输入要转换的镜像名称：

**支持的格式**：
```bash
nginx                              # 自动补全为 nginx:latest
nginx:1.20                        # 指定版本
docker.io/library/nginx:latest    # 完整地址
gcr.io/google-containers/pause:3.2
quay.io/prometheus/prometheus:latest
```

#### 第二步：配置目标仓库

**方式一：使用保存的配置**
1. 选择"使用已保存配置"
2. 从下拉列表选择已配置的仓库
3. 系统自动填充仓库信息

**方式二：手动输入**
1. 选择"手动输入配置"
2. 填写仓库地址、用户名、密码
3. 点击"测试连接"验证配置

#### 第三步：确认目标镜像
- 系统自动生成目标镜像名称
- 可手动修改目标镜像名称
- 点击复制按钮复制镜像地址

#### 第四步：开始转换
1. 检查所有配置信息
2. 点击"🚀 开始转换"按钮
3. 系统创建转换任务

### 2. 监控转换进度

转换任务创建后，系统会显示：

#### 当前执行任务卡片
- **任务信息**: 源镜像 → 目标镜像
- **执行状态**: 等待中/拉取中/标记中/推送中/完成/失败
- **进度条**: 显示当前执行进度
- **实时日志**: 查看详细执行日志
- **操作按钮**: 取消任务、查看详情

#### 任务状态说明
| 状态 | 说明 | 操作 |
|------|------|------|
| 等待中 | 任务已创建，等待执行 | 可取消 |
| 拉取中 | 正在从源仓库拉取镜像 | 可取消 |
| 标记中 | 正在重新标记镜像 | 不可取消 |
| 推送中 | 正在推送到目标仓库 | 不可取消 |
| 完成 | 转换成功完成 | 查看结果 |
| 失败 | 转换过程中出现错误 | 查看错误信息 |

## 🔧 功能详解

### 任务队列管理

当有多个转换任务时，系统支持队列管理：

#### 任务队列卡片功能
- **查看队列**: 显示等待执行的任务列表
- **优先级调整**: 上移/下移任务优先级
- **任务移除**: 从队列中移除任务
- **任务详情**: 查看任务的详细配置

#### 优先级调整
1. 在任务队列中找到要调整的任务
2. 点击"↑"按钮提高优先级
3. 点击"↓"按钮降低优先级
4. 最高优先级的任务会优先执行

### 仓库配置管理

#### 新增仓库配置
1. 在配置模式中选择"手动输入配置"
2. 填写完整的仓库信息
3. 点击"测试连接"验证
4. 测试成功后点击"保存配置"

#### 配置信息项
| 字段 | 必填 | 说明 | 示例 |
|------|------|------|------|
| 配置名称 | ✅ | 用于识别的名称 | 公司Harbor |
| 仓库地址 | ✅ | 仓库服务器地址 | harbor.company.com |
| 用户名 | ✅ | 仓库登录用户名 | admin |
| 密码 | ✅ | 仓库登录密码 | ******** |
| 命名空间 | ❌ | 默认命名空间 | transform |

#### 管理现有配置
1. 点击"管理配置"按钮
2. 在弹出的配置管理窗口中：
   - **编辑配置**: 修改配置信息
   - **删除配置**: 删除不需要的配置
   - **测试连接**: 重新测试配置

### 历史记录查看

#### 最近历史卡片
右侧显示最近的转换记录：
- 显示最近5条记录
- 包含状态、时间、镜像信息
- 点击"查看全部"打开详细历史

#### 完整历史记录
点击"查看全部历史"打开详细记录窗口：
- **筛选功能**: 按状态、时间筛选
- **搜索功能**: 按镜像名称搜索
- **排序功能**: 按时间、状态排序
- **详情查看**: 查看转换的详细信息
- **操作记录**: 显示完整的操作日志

### 统计信息

#### 任务统计卡片
显示系统运行统计：
- **总任务数**: 历史总转换次数
- **成功率**: 转换成功的百分比
- **今日任务**: 当天的转换次数
- **平均耗时**: 转换任务的平均用时

#### 详细统计信息
点击统计卡片查看更多统计：
- **时间趋势**: 每日转换量趋势
- **成功率趋势**: 成功率变化趋势
- **热门镜像**: 最常转换的镜像排行
- **错误分析**: 常见错误统计

## 🎯 高级功能

### 批量操作（即将支持）
- 批量镜像转换
- 批量配置管理
- 批量历史清理

### 自动化集成
#### API调用
系统提供RESTful API，支持程序化调用：

```bash
# 创建转换任务
curl -X POST http://localhost:8080/api/tasks \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "source_image": "nginx:latest",
    "target_image": "harbor.company.com/transform/nginx:latest",
    "config_id": "config-uuid"
  }'

# 查询任务状态
curl http://localhost:8080/api/tasks/task-id \
  -H "Authorization: Bearer your-token"
```

#### Webhook通知（规划中）
- 任务完成通知
- 失败告警通知
- 自定义通知规则

## ❓ 常见问题

### Q1: 镜像转换失败，提示网络错误？
**解决方案**：
1. 检查服务器网络连接
2. 确认可以访问源镜像仓库
3. 检查防火墙设置
4. 尝试使用代理服务器

### Q2: 推送到目标仓库失败？
**解决方案**：
1. 验证目标仓库地址是否正确
2. 检查用户名密码是否正确
3. 确认用户有推送权限
4. 检查命名空间是否存在

### Q3: 转换过程中断怎么办？
**解决方案**：
1. 查看任务详情了解中断原因
2. 重新创建转换任务
3. 检查系统资源使用情况
4. 查看系统日志排查问题

### Q4: 如何处理大镜像转换？
**建议**：
1. 在网络状况良好时进行
2. 确保足够的磁盘空间
3. 设置较长的超时时间
4. 考虑分层镜像优化

### Q5: Token忘记了怎么办？
**解决方案**：
1. 联系系统管理员重置
2. 重新部署服务（使用默认Token）
3. 直接修改数据库中的Token值

## 💡 最佳实践

### 1. 安全最佳实践
- **定期更换Token**: 建议每月更换一次
- **权限最小化**: 仓库用户只给必要的推送权限
- **网络隔离**: 部署在安全的网络环境中
- **日志监控**: 定期检查转换日志

### 2. 性能优化建议
- **磁盘空间**: 保持足够的磁盘空间（推荐50GB+）
- **网络带宽**: 使用高带宽网络环境
- **并发控制**: 避免同时进行过多转换任务
- **定期清理**: 清理不需要的历史记录

### 3. 运维建议
- **定期备份**: 备份数据库和配置文件
- **监控告警**: 设置系统监控和告警
- **日志轮转**: 配置日志文件轮转
- **版本升级**: 及时升级到最新版本

### 4. 镜像命名规范
- **统一前缀**: 使用统一的命名空间前缀
- **版本管理**: 保持原有的版本标签
- **描述清晰**: 使用清晰的镜像描述

## 📞 技术支持

### 获取帮助
- **在线文档**: 查阅最新的在线文档
- **GitHub Issues**: 提交Bug报告和功能请求
- **社区讨论**: 参与GitHub Discussions

### 反馈渠道
- **功能建议**: 通过GitHub Issues提交
- **Bug报告**: 详细描述复现步骤
- **使用疑问**: 在Discussions中讨论

---

**文档版本**: v1.0.0  
**更新日期**: 2025-01-28  
**适用版本**: Docker镜像转换服务 v1.0.0+